language: cpp
notifications:
  email:
    on_success: change
    on_failure: change
compiler:
  - gcc
#  - clang

addons:
  coverity_scan:
    # COVERITY_SCAN_TOKEN added as env var in travis project 
    project:
      name: onqtam/doctest
    notification_email: vik.kirilov@gmail.com
    build_command_prepend: cd examples/hello_world && cmake .
    build_command: make
    branch_pattern: coverity_scan

before_install:
  - sudo apt-get update -qq
  - sudo apt-get install -y -qq lcov curl valgrind tree
  - git submodule update --init --recursive
script:
  # COVERALLS_REPO_TOKEN added in env vars in travis
  - export COVERALLS_SERVICE_NAME=travis-ci
  - cmake -DCI_COVERAGE=ON .
  - cmake --build .
  - cmake --build . --target coveralls
#  - valgrind --leak-check=full --track-origins=yes --error-exitcode=1 ./exe
